import{u as e,r as o,k as t,x as n,O as s,S as l,a9 as a,b as i,m as d,D as r,w as c,n as p,j as u,B as h,o as N,aa as _,ab as m}from"./main-zXAllzd6.js";function x({option:e,index:t,options:n,totalVotes:s,withPollNode:l}){const{clientID:a}=N(),i=o.useRef(null),d=e.votes,r=-1!==d.indexOf(a),c=d.length,p=e.text;return u.jsxs("div",{className:"PollNode__optionContainer",children:[u.jsx("div",{className:_("PollNode__optionCheckboxWrapper",r&&"PollNode__optionCheckboxChecked"),children:u.jsx("input",{ref:i,className:"PollNode__optionCheckbox",type:"checkbox",onChange:o=>{l((o=>{o.toggleVote(e,a)}))},checked:r})}),u.jsxs("div",{className:"PollNode__optionInputWrapper",children:[u.jsx("div",{className:"PollNode__optionInputVotes",style:{width:(0===c?0:c/s*100)+"%"}}),u.jsx("span",{className:"PollNode__optionInputVotesCount",children:c>0&&(1===c?"1 vote":`${c} votes`)}),u.jsx("input",{className:"PollNode__optionInput",type:"text",value:p,onChange:o=>{const t=o.target,n=t.value,s=t.selectionStart,a=t.selectionEnd;l((o=>{o.setOptionText(e,n)}),(()=>{t.selectionStart=s,t.selectionEnd=a}))},placeholder:`Option ${t+1}`})]}),u.jsx("button",{disabled:n.length<3,className:_("PollNode__optionDelete",n.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{l((o=>{o.deleteOption(e)}))}})]})}function f({question:N,options:_,nodeKey:f}){const[j]=e(),v=o.useMemo((()=>function(e){return e.reduce(((e,o)=>e+o.votes.length),0)}(_)),[_]),[P,g,C]=t(f),[b,k]=o.useState(null),O=o.useRef(null),D=o.useCallback((e=>{if(P&&n(s())){e.preventDefault();const o=l(f);if(a(o))return o.remove(),!0}return!1}),[P,f]);o.useEffect((()=>i(j.registerUpdateListener((({editorState:e})=>{k(e.read((()=>s())))})),j.registerCommand(p,(e=>{const o=e;return o.target===O.current&&(o.shiftKey||C(),g(!P),!0)}),r),j.registerCommand(c,D,r),j.registerCommand(d,D,r))),[C,j,P,f,D,g]);const y=(e,o)=>{j.update((()=>{const o=l(f);a(o)&&e(o)}),{onUpdate:o})},I=n(b)&&P;return u.jsx("div",{className:"PollNode__container "+(I?"focused":""),ref:O,children:u.jsxs("div",{className:"PollNode__inner",children:[u.jsx("h2",{className:"PollNode__heading",children:N}),_.map(((e,o)=>{const t=e.uid;return u.jsx(x,{withPollNode:y,option:e,index:o,options:_,totalVotes:v},t)})),u.jsx("div",{className:"PollNode__footer",children:u.jsx(h,{onClick:()=>{y((e=>{e.addOption(m())}))},small:!0,children:"Add Option"})})]})})}export{f as default};
