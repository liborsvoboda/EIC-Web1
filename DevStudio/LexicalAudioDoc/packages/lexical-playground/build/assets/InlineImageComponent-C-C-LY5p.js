import{a4 as e,r as t,k as a,u as n,x as s,O as i,S as l,a5 as r,q as o,b as c,a as d,D as u,T as m,m as h,w as g,s as p,n as f,e as x,j,L as C,P as v,Y as b,Z as w,a0 as E,a6 as N,a7 as k,a8 as S,B as y}from"./main-zXAllzd6.js";import{d as I}from"./LexicalNestedComposer-BvRQ2YL8.js";const R=new Set;function D({altText:e,className:t,imageRef:a,src:n,width:s,height:i,position:l}){return function(e){if(!R.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{R.add(e),t(null)}}))}(n),j.jsx("img",{className:t||void 0,src:n,alt:e,ref:a,"data-position":l,style:{display:"block",height:i,width:s},draggable:"false"})}function T({activeEditor:e,nodeKey:a,onClose:n}){const s=e.getEditorState().read((()=>l(a))),[i,r]=t.useState(s.getAltText()),[o,c]=t.useState(s.getShowCaption()),[d,u]=t.useState(s.getPosition());return j.jsxs(j.Fragment,{children:[j.jsx("div",{style:{marginBottom:"1em"},children:j.jsx(N,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:r,value:i,"data-test-id":"image-modal-alt-text-input"})}),j.jsxs(k,{style:{marginBottom:"1em",width:"208px"},value:d,label:"Position",name:"position",id:"position-select",onChange:e=>{u(e.target.value)},children:[j.jsx("option",{value:"left",children:"Left"}),j.jsx("option",{value:"right",children:"Right"}),j.jsx("option",{value:"full",children:"Full Width"})]}),j.jsxs("div",{className:"Input__wrapper",children:[j.jsx("input",{id:"caption",type:"checkbox",checked:o,onChange:e=>{c(e.target.checked)}}),j.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),j.jsx(S,{children:j.jsx(y,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const t={altText:i,position:d,showCaption:o};s&&e.update((()=>{s.update(t)})),n()})(),children:"Confirm"})})]})}function _({src:N,altText:k,nodeKey:S,width:y,height:R,showCaption:_,caption:B,position:F}){const[K,L]=e(),P=t.useRef(null),A=t.useRef(null),[U,q,O]=a(S),[W]=n(),[Y,Z]=t.useState(null),z=t.useRef(null),G=t.useCallback((e=>{if(U&&s(i())){e.preventDefault();const t=l(S);if(r(t))return t.remove(),!0}return!1}),[U,S]),H=t.useCallback((e=>{const t=i(),a=A.current;if(U&&s(t)&&1===t.getNodes().length){if(_)return o(null),e.preventDefault(),B.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[B,U,_]),J=t.useCallback((e=>(z.current===B||A.current===e.target)&&(o(null),W.update((()=>{q(!0);const e=W.getRootElement();null!==e&&e.focus()})),!0)),[B,W,q]);t.useEffect((()=>{let e=!0;const t=c(W.registerUpdateListener((({editorState:t})=>{e&&Z(t.read((()=>i())))})),W.registerCommand(x,((e,t)=>(z.current=t,!1)),u),W.registerCommand(f,(e=>{const t=e;return t.target===P.current&&(t.shiftKey?q(!U):(O(),q(!0)),!0)}),u),W.registerCommand(p,(e=>e.target===P.current&&(e.preventDefault(),!0)),u),W.registerCommand(g,G,u),W.registerCommand(h,G,u),W.registerCommand(m,H,u),W.registerCommand(d,J,u));return()=>{e=!1,t()}}),[O,W,U,S,G,H,J,q]);const M=U&&s(Y),Q=U;return j.jsxs(t.Suspense,{fallback:null,children:[j.jsxs(j.Fragment,{children:[j.jsxs("span",{draggable:M,children:[j.jsx("button",{className:"image-edit-button",ref:A,onClick:()=>{L("Update Inline Image",(e=>j.jsx(T,{activeEditor:W,nodeKey:S,onClose:e})))},children:"Edit"}),j.jsx(D,{className:Q?"focused "+(s(Y)?"draggable":""):null,src:N,altText:k,imageRef:P,width:y,height:R,position:F})]}),_&&j.jsx("span",{className:"image-caption-container",children:j.jsxs(I,{initialEditor:B,children:[j.jsx(C,{}),j.jsx(v,{}),j.jsx(b,{contentEditable:j.jsx(w,{placeholder:"Enter a caption...",placeholderClassName:"InlineImageNode__placeholder",className:"InlineImageNode__contentEditable"}),ErrorBoundary:E})]})})]}),K]})}export{T as UpdateInlineImageDialog,_ as default};
