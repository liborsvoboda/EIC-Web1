import{r as e,j as n,u as t,S as a,$ as s,b as r,a as i,F as o,e as l,O as u,x as c,E as d,K as E}from"./main-zXAllzd6.js";function m({equation:e,setEquation:t,inline:a},s){const r=e=>{t(e.target.value)};return a&&s instanceof HTMLInputElement?n.jsxs("span",{className:"EquationEditor_inputBackground",children:[n.jsx("span",{className:"EquationEditor_dollarSign",children:"$"}),n.jsx("input",{className:"EquationEditor_inlineEditor",value:e,onChange:r,autoFocus:!0,ref:s}),n.jsx("span",{className:"EquationEditor_dollarSign",children:"$"})]}):n.jsxs("div",{className:"EquationEditor_inputBackground",children:[n.jsx("span",{className:"EquationEditor_dollarSign",children:"$$\n"}),n.jsx("textarea",{className:"EquationEditor_blockEditor",value:e,onChange:r,ref:s}),n.jsx("span",{className:"EquationEditor_dollarSign",children:"\n$$"})]})}const f=e.forwardRef(m);function x({equation:m,inline:x,nodeKey:g}){const[q]=t(),[j,p]=e.useState(m),[h,N]=e.useState(!1),_=e.useRef(null),S=e.useCallback((e=>{N(!1),q.update((()=>{const n=a(g);s(n)&&(n.setEquation(j),e&&n.selectNext(0,0))}))}),[q,j,g]);return e.useEffect((()=>{h||j===m||p(m)}),[h,m,j]),e.useEffect((()=>h?r(q.registerCommand(l,(e=>{const n=document.activeElement;return _.current!==n&&S(),!1}),o),q.registerCommand(i,(e=>{const n=document.activeElement;return _.current===n&&(S(!0),!0)}),o)):q.registerUpdateListener((({editorState:e})=>{e.read((()=>{const e=u();return c(e)&&e.has(g)&&1===e.getNodes().length}))&&N(!0)}))),[q,g,S,h]),n.jsx(n.Fragment,{children:h?n.jsx(f,{equation:j,setEquation:p,inline:x,ref:_}):n.jsx(d,{onError:e=>q._onError(e),fallback:null,children:n.jsx(E,{equation:j,inline:x,onDoubleClick:()=>N(!0)})})})}export{x as default};
